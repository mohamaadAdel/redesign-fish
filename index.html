<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#0a0e27">
    <title>100 Reasons I Love You, fish 💕</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        :root {
            --primary-dark: #0a0e27;
            --secondary-dark: #1a1f3a;
            --accent-blue: #4a69bd;
            --accent-purple: #6c5ce7;
            --accent-pink: #fd79a8;
            --accent-gold: #fdcb6e;
            --heart-red: #ff4757;
            --heart-pink: #ff6b9d;
            --text-light: #dfe6e9;
            --text-dim: #b2bec3;
            --white: #ffffff;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: var(--primary-dark);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: var(--text-light);
            overflow: hidden;
            position: relative;
        }

        /* Safe area */
        .safe-area {
            height: env(safe-area-inset-top, 0);
            background: var(--primary-dark);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        /* Starry background */
        .universe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            overflow: hidden;
            z-index: 0;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Shooting stars */
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            animation: shoot 3s linear infinite;
            opacity: 0;
        }

        .shooting-star::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 2px;
            background: linear-gradient(to left, transparent, white);
            transform: translateX(-100px);
        }

        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0) rotate(-45deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateX(-500px) translateY(500px) rotate(-45deg);
                opacity: 0;
            }
        }

        /* App container */
        .app-container {
            position: relative;
            height: 100vh;
            height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            z-index: 1;
            padding-top: env(safe-area-inset-top, 0);
        }

        /* Header */
        .header {
            padding: 12px 20px;
            text-align: center;
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--heart-red), var(--heart-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        .subtitle {
            font-size: clamp(0.7rem, 2.5vw, 0.85rem);
            color: var(--text-dim);
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .heart-symbol {
            font-size: 1.2rem;
            margin: 3px 0;
            color: var(--heart-red);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Heart constellation map */
        .constellation-map {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        /* Heart container */
        .heart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            height: 450px;
        }

        /* Message emojis */
        .message-emoji {
            position: absolute;
            width: 32px;
            height: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 71, 87, 0.2);
        }

        .message-emoji.revealed {
            background: rgba(255, 71, 87, 0.15);
            border-color: var(--heart-red);
            transform: scale(1.15);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.6);
            animation: heartbeat 1s ease-in-out;
        }

        @keyframes heartbeat {
            0% { transform: scale(1.15); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.15); }
        }

        /* Heart lines */
        .heart-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(255, 71, 87, 0.3), transparent);
            transform-origin: left center;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .heart-line.visible {
            opacity: 1;
        }

        /* Message display area */
        .message-display {
            position: absolute;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            transform: translateY(150%);
            transition: transform 0.5s ease;
            z-index: 50;
            max-width: 500px;
            margin: 0 auto;
        }

        .message-display.show {
            transform: translateY(0);
        }

        .message-number {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--heart-red), var(--heart-pink));
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .message-text {
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-light);
        }

        /* Navigation */
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 14, 39, 0.9);
            backdrop-filter: blur(20px);
            padding: 12px 20px calc(12px + env(safe-area-inset-bottom, 0));
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-button {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 6px;
        }

        .nav-button:active {
            color: var(--heart-red);
            transform: scale(0.9);
        }

        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .progress-dots {
            display: flex;
            gap: 4px;
        }

        .progress-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .progress-dot.revealed {
            background: var(--heart-red);
            transform: scale(1.2);
        }

        /* Music player - Mobile optimized */
        .music-player {
            position: fixed;
            top: calc(75px + env(safe-area-inset-top, 0));
            right: 10px;
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(20px);
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 150;
            border: 1px solid rgba(255, 71, 87, 0.2);
            transition: all 0.3s ease;
        }

        .music-player:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .music-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--heart-red), var(--heart-pink));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7rem;
        }

        .music-btn:active {
            transform: scale(0.9);
        }

        .music-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
            max-width: 100px;
            position: relative;
        }

        .music-title {
            font-size: 0.65rem;
            color: var(--text-light);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            padding: 2px 3px;
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .music-title:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .music-status {
            font-size: 0.55rem;
            color: var(--text-dim);
        }

        /* Song dropdown */
        .song-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 3px;
            background: rgba(26, 31, 58, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 10px;
            min-width: 150px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
        }

        .song-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .song-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .song-item:last-child {
            border-bottom: none;
        }

        .song-item:hover {
            background: rgba(255, 71, 87, 0.1);
        }

        .song-item.active {
            background: rgba(255, 71, 87, 0.2);
            color: var(--heart-pink);
        }

        .song-item i {
            font-size: 0.7rem;
            color: var(--heart-red);
        }

        .song-item.active i {
            color: var(--heart-pink);
        }

        .song-name {
            font-size: 0.7rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Complete modal */
        .complete-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.98);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 300;
        }

        .complete-modal.show {
            display: flex;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .complete-content {
            text-align: center;
            max-width: 380px;
        }

        .complete-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .complete-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--heart-red), var(--heart-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        .complete-message {
            font-size: 1rem;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .complete-button {
            background: linear-gradient(135deg, var(--heart-red), var(--heart-pink));
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .complete-button:active {
            transform: scale(0.95);
        }

        /* Instructions */
        .instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-dim);
            font-size: 0.9rem;
            z-index: 5;
            pointer-events: none;
            animation: fadeInOut 4s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Touch feedback */
        .touch-ripple {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 71, 87, 0.4), transparent);
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: ripple 0.6s ease-out;
            z-index: 9999;
        }

        @keyframes ripple {
            from {
                width: 0;
                height: 0;
                opacity: 1;
            }
            to {
                width: 60px;
                height: 60px;
                opacity: 0;
            }
        }

        /* Floating hearts animation */
        .floating-heart {
            position: absolute;
            bottom: -50px;
            font-size: 1.5rem;
            opacity: 0.7;
            animation: float-up 8s linear infinite;
            z-index: 2;
        }

        @keyframes float-up {
            0% {
                bottom: -50px;
                transform: translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                bottom: 100vh;
                transform: translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
                min-height: 65px;
            }
            
            .title {
                font-size: clamp(1.4rem, 6vw, 1.8rem);
            }
            
            .heart-container {
                max-width: 90vw;
                height: 55vh;
                max-height: 400px;
            }
            
            .message-emoji {
                width: 36px;
                height: 36px;
                font-size: 1.3rem;
            }
            
            .message-display {
                padding: 15px;
                max-width: 90%;
                bottom: 70px;
            }
            
            .message-text {
                font-size: 1rem;
            }
            
            .music-player {
                top: calc(68px + env(safe-area-inset-top, 0));
                right: 8px;
                padding: 6px;
                gap: 5px;
            }
            
            .music-btn {
                width: 26px;
                height: 26px;
                font-size: 0.65rem;
            }
            
            .music-info {
                max-width: 85px;
            }
            
            .navigation {
                padding: 10px 15px calc(10px + env(safe-area-inset-bottom, 0));
            }
            
            .nav-button {
                font-size: 1.2rem;
                padding: 6px;
            }
            
            .progress-text {
                font-size: 0.85rem;
            }
            
            .progress-dot {
                width: 7px;
                height: 7px;
            }
            
            .song-dropdown {
                min-width: 140px;
                max-height: 180px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 8px 12px;
                min-height: 60px;
            }
            
            .title {
                font-size: clamp(1.2rem, 7vw, 1.6rem);
                margin-bottom: 1px;
            }
            
            .subtitle {
                font-size: clamp(0.65rem, 3.5vw, 0.75rem);
            }
            
            .heart-symbol {
                font-size: 1rem;
                margin: 2px 0;
            }
            
            .heart-container {
                height: 50vh;
                max-height: 350px;
            }
            
            .message-emoji {
                width: 32px;
                height: 32px;
                font-size: 1.1rem;
            }
            
            .message-display {
                padding: 12px;
                bottom: 65px;
            }
            
            .message-text {
                font-size: 0.95rem;
            }
            
            .music-player {
                top: calc(62px + env(safe-area-inset-top, 0));
                right: 5px;
                padding: 5px;
                gap: 4px;
            }
            
            .music-btn {
                width: 24px;
                height: 24px;
                font-size: 0.6rem;
            }
            
            .music-info {
                max-width: 75px;
            }
            
            .music-title {
                font-size: 0.6rem;
            }
            
            .music-status {
                font-size: 0.5rem;
            }
            
            .song-dropdown {
                right: -5px;
                min-width: 130px;
            }
            
            .song-item {
                padding: 6px 10px;
            }
            
            .song-name {
                font-size: 0.65rem;
            }
        }

        @media (max-width: 320px) {
            .header {
                min-height: 55px;
                padding: 6px 10px;
            }
            
            .title {
                font-size: clamp(1.1rem, 8vw, 1.4rem);
            }
            
            .subtitle {
                font-size: 0.6rem;
            }
            
            .heart-symbol {
                font-size: 0.9rem;
            }
            
            .message-display {
                padding: 10px;
                bottom: 60px;
            }
            
            .message-text {
                font-size: 0.9rem;
            }
            
            .message-emoji {
                width: 28px;
                height: 28px;
                font-size: 1rem;
            }
            
            .heart-container {
                height: 45vh;
                max-height: 300px;
            }
            
            .music-player {
                top: calc(57px + env(safe-area-inset-top, 0));
                padding: 4px;
            }
            
            .music-btn {
                width: 22px;
                height: 22px;
                font-size: 0.55rem;
            }
            
            .music-info {
                max-width: 65px;
            }
            
            .music-title {
                font-size: 0.55rem;
            }
            
            .navigation {
                padding: 8px 10px calc(8px + env(safe-area-inset-bottom, 0));
            }
        }

        /* Landscape orientation adjustments */
        @media (max-height: 600px) and (orientation: landscape) {
            .header {
                min-height: 50px;
                padding: 6px 15px;
            }
            
            .title {
                font-size: clamp(1.2rem, 4vw, 1.5rem);
                margin-bottom: 0;
            }
            
            .subtitle {
                font-size: 0.65rem;
            }
            
            .heart-symbol {
                font-size: 0.9rem;
                margin: 1px 0;
            }
            
            .music-player {
                top: calc(52px + env(safe-area-inset-top, 0));
            }
            
            .heart-container {
                height: 65vh;
                max-height: 300px;
            }
        }

        /* Performance */
        .gpu-accelerated {
            transform: translateZ(0);
            will-change: transform;
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Safe area -->
    <div class="safe-area"></div>

    <!-- Starry background -->
    <div class="universe">
        <div class="stars" id="stars"></div>
    </div>

    <!-- App container -->
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="title">For My Dearest fishii</h1>
            <div class="heart-symbol">💕</div>
            <p class="subtitle">100 Reasons Why I Love You</p>
        </header>

        <!-- Heart constellation map -->
        <main class="constellation-map" id="constellationMap">
            <div class="instructions" id="instructions">
                <div>💕 Tap the hearts to discover my love</div>
            </div>
            
            <div class="heart-container" id="heartContainer">
                <!-- Heart shape will be created here -->
            </div>
        </main>

        <!-- Message display area -->
        <div class="message-display" id="messageDisplay">
            <div class="message-number" id="messageNumber">1</div>
            <div class="message-text" id="messageText"></div>
        </div>

        <!-- Navigation -->
        <nav class="navigation">
            <button class="nav-button" id="resetBtn" aria-label="Reset">
                <i class="fas fa-redo"></i>
            </button>
            
            <div class="progress-indicator">
                <span class="progress-text" id="progressText">0 revealed</span>
                <div class="progress-dots" id="progressDots"></div>
            </div>
            
            <button class="nav-button" id="autoPlayBtn" aria-label="Auto Play">
                <i class="fas fa-play"></i>
            </button>
        </nav>

        <!-- Music player with dropdown -->
        <div class="music-player" id="musicPlayer">
            <button class="music-btn" id="prevBtn" aria-label="Previous">
                <i class="fas fa-backward"></i>
            </button>
            <button class="music-btn" id="playPauseBtn" aria-label="Play/Pause">
                <i class="fas fa-play" id="playIcon"></i>
            </button>
            <button class="music-btn" id="nextBtn" aria-label="Next">
                <i class="fas fa-forward"></i>
            </button>
            <div class="music-info">
                <div class="music-title" id="musicTitle">Our Songs</div>
                <div class="music-status" id="musicStatus">Tap to play</div>
                <div class="song-dropdown" id="songDropdown">
                    <!-- Song items will be created here -->
                </div>
            </div>
        </div>

        <!-- Complete modal -->
        <div class="complete-modal" id="completeModal">
            <div class="complete-content">
                <div class="complete-icon">💕</div>
                <h2 class="complete-title">Our Complete Heart</h2>
                <p class="complete-message">You've unlocked every piece of my heart. Each reason represents a different feeling I have for you, all coming together to form the love I feel.</p>
                <p class="complete-message">I love you, fish Now and forever. 💕</p>
                <button class="complete-button" id="completeButton">View Again</button>
            </div>
        </div>
    </div>

    <!-- Audio container -->
    <div id="audioContainer"></div>

    <script>
        // Letter content
        const letterContent = [
            "You make me happy.",
            "You make me to want a better version of myself😔.",
            "You love me in the times when I'm so insfurable and annoying, overwhelming",
         
            "You forgive me quickly. even tho i did bad things for u im sorry",
            "You understand me. And when you don't, you try to and you go all in to get clarity about the things you don't understand.",
            "You respect my boundaries. and feelings",
            "You see and you love the next best version of me.",
            "You open yourself up for me.",
            "You are truthful and vulnerable with me. (UR NOT FUCK YOU)",
            "You don't play games or toy with me .",
            "You throw away the masks that don't serve you.",
            "You are doing everything to be better everyday i love it about u.",
            "You are the prettiest ever.",
            "You have the most beautiful eyes. Not just \"beautiful big eyes\". But the eyes I look into when I'm not sure if you love me and and their answer is always \"yes\".",
            "You have a gentle, innocent smile that always comforts me.",
            "your lovely voice makes me melt so bad",
            "You are sad and you share your sadness with me. (not always and fuck you",
            "You have the smoothest skin. I could spend hours just watching and caressing it.",
            "Your energy is relaxing and peacful.",
            "You have a cute and calming voice that soothes me when I'm down.",
            "the time i spend with u is the most fun and entertaining ",
            "You are the only person who makes me laugh more then I can make myself laugh.",
            "You know how to calm me down when I'm overthingking.",
            "You have a unique dressing style amd its so pretty ur fashion sense is better than mine",
            "You are so smart and a fast learner.",
            "You taught me how to love unconditionally.",
            "You allow me be myself and let me be as annoying and clingy as iam.",
            "You always give your best and all u can ",
            "You love and enjoy nature and peace i also do.",
            "i love you.",
            "You care about my opinion and u ask my about my opinion when ur taking a decision, i know its so dumb but thank u for doing that, thank u so much i love ytou ",
            "you are who you are and that is the best thing ever ."
        
        ];

        // Only use the specified emojis
        const heartEmojis = ['💕', '❤️', '💖', '💗', '💓', '💝', '💘', '💞', '💟', '❣️'];
        
        // Updated to only include 3 songs
        const songFiles = ['song.mp3', 'song2.mp3', 'song3.mp3'];
        const songTitles = ['Our First Song', 'Our Second Song', 'Our Third Song'];

        // App state
        const app = {
            currentSong: 0,
            isPlaying: false,
            userInteracted: false,
            revealedEmojis: new Set(),
            autoPlaying: false,
            audioElements: [],
            emojiPositions: [],
            heartLines: [],
            currentReasonIndex: 0,
            messageDisplayTimeout: null,
            dropdownOpen: false
        };

        // Initialize app
        function init() {
            createAudioElements();
            createStarryBackground();
            createDetailedHeart();
            setupEventListeners();
            createProgressDots();
            setupTouchOptimizations();
            createFloatingHearts();
            createSongDropdown();
        }

        // Create audio elements
        function createAudioElements() {
            const container = document.getElementById('audioContainer');
            songFiles.forEach((file, index) => {
                const audio = document.createElement('audio');
                audio.id = `audio${index}`;
                audio.preload = 'none';
                audio.volume = 0.5;
                container.appendChild(audio);
                app.audioElements.push(audio);
                
                audio.addEventListener('ended', () => {
                    if (app.isPlaying) {
                        playNext();
                    }
                });
            });
        }

        // Create song dropdown
        function createSongDropdown() {
            const dropdown = document.getElementById('songDropdown');
            
            songTitles.forEach((title, index) => {
                const songItem = document.createElement('div');
                songItem.className = 'song-item';
                songItem.dataset.index = index;
                
                const icon = document.createElement('i');
                icon.className = index === app.currentSong ? 'fas fa-play' : 'fas fa-music';
                
                const songName = document.createElement('div');
                songName.className = 'song-name';
                songName.textContent = title;
                
                songItem.appendChild(icon);
                songItem.appendChild(songName);
                
                songItem.addEventListener('click', () => {
                    selectSong(index);
                });
                
                dropdown.appendChild(songItem);
            });
        }

        // Select song from dropdown
        function selectSong(index) {
            app.currentSong = index;
            
            // Update active state in dropdown
            document.querySelectorAll('.song-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
                const icon = item.querySelector('i');
                icon.className = i === index ? 'fas fa-play' : 'fas fa-music';
            });
            
            // Update music title
            document.getElementById('musicTitle').textContent = songTitles[index];
            
            // Play if currently playing
            if (app.isPlaying) {
                playCurrentSong();
            }
            
            // Close dropdown
            closeDropdown();
        }

        // Open dropdown
        function openDropdown() {
            const dropdown = document.getElementById('songDropdown');
            dropdown.classList.add('show');
            app.dropdownOpen = true;
            
            // Update active state
            document.querySelectorAll('.song-item').forEach((item, i) => {
                item.classList.toggle('active', i === app.currentSong);
                const icon = item.querySelector('i');
                icon.className = i === app.currentSong ? 'fas fa-play' : 'fas fa-music';
            });
        }

        // Close dropdown
        function closeDropdown() {
            const dropdown = document.getElementById('songDropdown');
            dropdown.classList.remove('show');
            app.dropdownOpen = false;
        }

        // Create starry background
        function createStarryBackground() {
            const starsContainer = document.getElementById('stars');
            const universe = document.querySelector('.universe');
            
            // Create background stars
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 2.5}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 4}s`;
                starsContainer.appendChild(star);
            }
            
            // Create shooting stars
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const shootingStar = document.createElement('div');
                    shootingStar.className = 'shooting-star';
                    shootingStar.style.left = `${Math.random() * 100}%`;
                    shootingStar.style.top = `${Math.random() * 50}%`;
                    universe.appendChild(shootingStar);
                    
                    setTimeout(() => shootingStar.remove(), 3000);
                }
            }, 4000);
        }

        // Create floating hearts
        function createFloatingHearts() {
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const heart = document.createElement('div');
                    heart.className = 'floating-heart';
                    heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
                    heart.style.left = `${Math.random() * 100}%`;
                    heart.style.animationDuration = `${6 + Math.random() * 4}s`;
                    heart.style.opacity = `${0.3 + Math.random() * 0.4}`;
                    document.querySelector('.universe').appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 10000);
                }
            }, 3000);
        }

        // Create detailed heart shape with many emojis
        function createDetailedHeart() {
            const container = document.getElementById('heartContainer');
            const containerRect = container.getBoundingClientRect();
            const centerX = containerRect.width / 2;
            const centerY = containerRect.height / 2;
            const scale = Math.min(centerX, centerY) * 0.8;
            
            // Create a very detailed heart shape with many points
            const heartPoints = [];
            const layers = 5; // Multiple layers for density
            const pointsPerLayer = 20;
            
            for (let layer = 0; layer < layers; layer++) {
                const layerScale = 1 - (layer * 0.15); // Each layer slightly smaller
                
                for (let i = 0; i < pointsPerLayer; i++) {
                    const t = (i / pointsPerLayer) * 2 * Math.PI;
                    
                    // Heart curve equation
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    
                    // Add some randomness for organic feel
                    const randomOffset = 5;
                    const offsetX = (Math.random() - 0.5) * randomOffset;
                    const offsetY = (Math.random() - 0.5) * randomOffset;
                    
                    // Scale and position
                    const posX = centerX + (x * scale * 0.04 * layerScale) + offsetX;
                    const posY = centerY + (y * scale * 0.04 * layerScale) + offsetY;
                    
                    // Only add points within heart bounds
                    const distanceFromCenter = Math.sqrt(Math.pow(posX - centerX, 2) + Math.pow(posY - centerY, 2));
                    if (distanceFromCenter < scale * 0.8) {
                        heartPoints.push({ x: posX, y: posY, index: heartPoints.length });
                    }
                }
            }
            
            // Add center cluster for more density
            for (let i = 0; i < 15; i++) {
                const angle = (i / 15) * 2 * Math.PI;
                const radius = Math.random() * scale * 0.2;
                const posX = centerX + Math.cos(angle) * radius;
                const posY = centerY + Math.sin(angle) * radius;
                
                heartPoints.push({ x: posX, y: posY, index: heartPoints.length });
            }
            
            // Create emoji elements for each point
            const totalPoints = Math.min(letterContent.length, heartPoints.length);
            
            for (let i = 0; i < totalPoints; i++) {
                const point = heartPoints[i];
                app.emojiPositions.push({ x: point.x, y: point.y, index: i });
                
                // Create emoji element
                const emoji = document.createElement('div');
                emoji.className = 'message-emoji gpu-accelerated';
                
                // Adjust emoji size based on screen size
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;
                const emojiSize = isSmallMobile ? 14 : (isMobile ? 16 : 16);
                
                emoji.style.left = `${point.x - emojiSize}px`;
                emoji.style.top = `${point.y - emojiSize}px`;
                emoji.dataset.index = i;
                
                // Use the specified emojis in order, repeating as needed
                const emojiChar = heartEmojis[i % heartEmojis.length];
                emoji.textContent = emojiChar;
                
                container.appendChild(emoji);
                
                // Add click event
                emoji.addEventListener('click', () => revealNextMessage());
                emoji.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    revealNextMessage();
                });
            }
            
            // Create heart lines connecting nearby emojis
            createHeartLines();
        }

        // Create heart lines
        function createHeartLines() {
            const container = document.getElementById('heartContainer');
            
            // Connect nearby emojis to form heart shape
            for (let i = 0; i < app.emojiPositions.length; i++) {
                for (let j = i + 1; j < app.emojiPositions.length; j++) {
                    const emoji1 = app.emojiPositions[i];
                    const emoji2 = app.emojiPositions[j];
                    const distance = Math.sqrt(
                        Math.pow(emoji2.x - emoji1.x, 2) + 
                        Math.pow(emoji2.y - emoji1.y, 2)
                    );
                    
                    // Connect emojis that are close enough
                    if (distance < 60 && Math.random() > 0.4) {
                        const line = document.createElement('div');
                        line.className = 'heart-line';
                        line.dataset.emojis = `${i}-${j}`;
                        
                        const angle = Math.atan2(emoji2.y - emoji1.y, emoji2.x - emoji1.x);
                        const length = distance;
                        
                        line.style.width = `${length}px`;
                        line.style.left = `${emoji1.x}px`;
                        line.style.top = `${emoji1.y}px`;
                        line.style.transform = `rotate(${angle}rad)`;
                        
                        container.appendChild(line);
                        app.heartLines.push(line);
                    }
                }
            }
        }

        // Reveal next message in sequence
        function revealNextMessage() {
            if (app.currentReasonIndex >= letterContent.length) {
                // All reasons have been revealed
                showCompleteModal();
                return;
            }
            
            // Update the clicked emoji appearance
            const allEmojis = document.querySelectorAll('.message-emoji');
            const randomEmoji = allEmojis[Math.floor(Math.random() * allEmojis.length)];
            randomEmoji.classList.add('revealed');
            
            // Show heart lines connected to this emoji
            app.heartLines.forEach(line => {
                const emojis = line.dataset.emojis.split('-').map(Number);
                if (emojis.includes(parseInt(randomEmoji.dataset.index))) {
                    line.classList.add('visible');
                }
            });
            
            // Show message in the display area instead of modal
            const messageDisplay = document.getElementById('messageDisplay');
            const messageNumber = document.getElementById('messageNumber');
            const messageText = document.getElementById('messageText');
            
            messageNumber.textContent = app.currentReasonIndex + 1;
            messageText.textContent = letterContent[app.currentReasonIndex];
            
            // Clear any existing timeout
            if (app.messageDisplayTimeout) {
                clearTimeout(app.messageDisplayTimeout);
            }
            
            // Show the message display
            messageDisplay.classList.add('show');
            
            // Auto-hide after 5 seconds
            app.messageDisplayTimeout = setTimeout(() => {
                messageDisplay.classList.remove('show');
            }, 5000);
            
            // Increment the current reason index
            app.currentReasonIndex++;
            
            // Update progress
            updateProgress();
            
            // Hide instructions after first emoji
            if (app.currentReasonIndex === 1) {
                document.getElementById('instructions').style.display = 'none';
            }
            
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        }

        // Update progress
        function updateProgress() {
            const total = letterContent.length;
            const revealed = app.currentReasonIndex;
            
            document.getElementById('progressText').textContent = `${revealed} revealed`;
            
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('revealed', index < revealed);
            });
        }

        // Create progress dots
        function createProgressDots() {
            const container = document.getElementById('progressDots');
            const total = letterContent.length;
            
            for (let i = 0; i < total; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                container.appendChild(dot);
            }
        }

        // Show complete modal
        function showCompleteModal() {
            document.getElementById('completeModal').classList.add('show');
            
            // Create celebration effect
            createCelebration();
        }

        // Create celebration effect
        function createCelebration() {
            const universe = document.querySelector('.universe');
            
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'shooting-star';
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.animationDuration = `${1 + Math.random() * 2}s`;
                    universe.appendChild(star);
                    
                    setTimeout(() => star.remove(), 3000);
                }, i * 50);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Message display click to close
            document.getElementById('messageDisplay').addEventListener('click', () => {
                document.getElementById('messageDisplay').classList.remove('show');
                if (app.messageDisplayTimeout) {
                    clearTimeout(app.messageDisplayTimeout);
                }
            });
            
            // Complete modal
            document.getElementById('completeButton').addEventListener('click', () => {
                document.getElementById('completeModal').classList.remove('show');
                resetHeart();
            });
            
            // Navigation buttons
            document.getElementById('resetBtn').addEventListener('click', resetHeart);
            document.getElementById('autoPlayBtn').addEventListener('click', toggleAutoPlay);
            
            // Music controls
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('prevBtn').addEventListener('click', playPrevious);
            document.getElementById('nextBtn').addEventListener('click', playNext);
            
            // Music title click to open dropdown
            document.getElementById('musicTitle').addEventListener('click', (e) => {
                e.stopPropagation();
                if (app.dropdownOpen) {
                    closeDropdown();
                } else {
                    openDropdown();
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (app.dropdownOpen && !e.target.closest('.music-info')) {
                    closeDropdown();
                }
            });
            
            // Visibility change
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // Handle window resize
            window.addEventListener('resize', handleResize);
        }

        // Handle window resize
        function handleResize() {
            // Recalculate heart positions on resize
            const container = document.getElementById('heartContainer');
            container.innerHTML = '';
            app.emojiPositions = [];
            app.heartLines = [];
            createDetailedHeart();
        }

        // Reset heart
        function resetHeart() {
            app.currentReasonIndex = 0;
            app.autoPlaying = false;
            
            // Reset emojis
            document.querySelectorAll('.message-emoji').forEach(emoji => {
                emoji.classList.remove('revealed');
            });
            
            // Reset heart lines
            app.heartLines.forEach(line => {
                line.classList.remove('visible');
            });
            
            // Reset progress
            updateProgress();
            
            // Hide message display
            document.getElementById('messageDisplay').classList.remove('show');
            
            // Show instructions
            document.getElementById('instructions').style.display = 'block';
            
            // Update auto play button
            document.getElementById('autoPlayBtn').innerHTML = '<i class="fas fa-play"></i>';
        }

        // Toggle auto play
        function toggleAutoPlay() {
            app.autoPlaying = !app.autoPlaying;
            const btn = document.getElementById('autoPlayBtn');
            
            if (app.autoPlaying) {
                btn.innerHTML = '<i class="fas fa-pause"></i>';
                autoRevealNext();
            } else {
                btn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        // Auto reveal next emoji
        function autoRevealNext() {
            if (!app.autoPlaying) return;
            
            if (app.currentReasonIndex < letterContent.length) {
                revealNextMessage();
                setTimeout(autoRevealNext, 2000);
            } else {
                app.autoPlaying = false;
                document.getElementById('autoPlayBtn').innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        // Music functions
        function togglePlayPause() {
            if (!app.userInteracted) {
                app.userInteracted = true;
            }

            if (app.isPlaying) {
                pauseCurrentSong();
            } else {
                playCurrentSong();
            }
        }

        function playCurrentSong() {
            const audio = app.audioElements[app.currentSong];
            
            app.audioElements.forEach((otherAudio, index) => {
                if (index !== app.currentSong) {
                    otherAudio.pause();
                    otherAudio.currentTime = 0;
                }
            });
            
            audio.src = songFiles[app.currentSong];
            audio.play().then(() => {
                app.isPlaying = true;
                updateMusicUI();
            }).catch(err => {
                console.log('Audio play failed:', err);
                app.isPlaying = false;
                updateMusicUI();
            });
        }

        function pauseCurrentSong() {
            const audio = app.audioElements[app.currentSong];
            if (audio) {
                audio.pause();
            }
            app.isPlaying = false;
            updateMusicUI();
        }

        function playPrevious() {
            app.currentSong = app.currentSong === 0 ? songFiles.length - 1 : app.currentSong - 1;
            if (app.isPlaying) playCurrentSong();
            updateMusicUI();
            updateDropdownSelection();
        }

        function playNext() {
            app.currentSong = (app.currentSong + 1) % songFiles.length;
            if (app.isPlaying) playCurrentSong();
            updateMusicUI();
            updateDropdownSelection();
        }

        function updateMusicUI() {
            const playIcon = document.getElementById('playIcon');
            playIcon.className = app.isPlaying ? 'fas fa-pause' : 'fas fa-play';
            
            document.getElementById('musicTitle').textContent = songTitles[app.currentSong];
            document.getElementById('musicStatus').textContent = app.isPlaying ? 'Playing' : 'Paused';
        }

        function updateDropdownSelection() {
            document.querySelectorAll('.song-item').forEach((item, i) => {
                item.classList.toggle('active', i === app.currentSong);
                const icon = item.querySelector('i');
                icon.className = i === app.currentSong ? 'fas fa-play' : 'fas fa-music';
            });
        }

        function handleVisibilityChange() {
            if (document.hidden && app.isPlaying) {
                pauseCurrentSong();
            }
        }

        // Setup touch optimizations
        function setupTouchOptimizations() {
            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Add touch feedback
            document.addEventListener('touchstart', function(e) {
                createTouchRipple(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: true });
            
            // Add swipe gesture for navigation
            let touchStartX = 0;
            let touchStartY = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                if (!touchStartX || !touchStartY) {
                    return;
                }
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const dx = touchEndX - touchStartX;
                const dy = touchEndY - touchStartY;
                
                // Determine if swipe was horizontal or vertical
                if (Math.abs(dx) > Math.abs(dy)) {
                    // Horizontal swipe
                    if (dx > 50) {
                        // Swipe right - previous song
                        playPrevious();
                    } else if (dx < -50) {
                        // Swipe left - next song
                        playNext();
                    }
                } else {
                    // Vertical swipe
                    if (dy > 50) {
                        // Swipe down - hide message display if visible
                        const messageDisplay = document.getElementById('messageDisplay');
                        if (messageDisplay.classList.contains('show')) {
                            messageDisplay.classList.remove('show');
                            if (app.messageDisplayTimeout) {
                                clearTimeout(app.messageDisplayTimeout);
                            }
                        }
                    }
                }
                
                // Reset values
                touchStartX = 0;
                touchStartY = 0;
            }, { passive: true });
        }

        // Create touch ripple
        function createTouchRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'touch-ripple';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            document.body.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
